stages:
  - build
  - test
  - deploy

variables:
  PROJECT_DIR: "~/projectvictory-test"
  SERVER_NAME: "django"

building_server_app:
  stage: build
  tags:
    - shell
  script:
    - sudo cp -r Backend/victory $PROJECT_DIR/backend/
    - docker build -t server:$CI_COMMIT_SHORT_SHA $PROJECT_DIR/backend/victory/
  only:
    - dev

run_server_app:
  stage: test
  tags:
    - shell
  script:
    - docker run --rm --name $SERVER_NAME -d -p 5000:8000 server:$CI_COMMIT_SHORT_SHA
  after_script:
    - docker system prune -af
  only:
    - dev
